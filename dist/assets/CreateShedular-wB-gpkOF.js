import{c as I,j as e,r as c,q as C,F as L,A as P,p as x,B as W,z as o}from"./index-DZU4KrgL.js";import{a as d,b as h}from"./api-CDOf7xde.js";import{A as F}from"./ApiError-CSfGLBE_.js";import{D as H}from"./Delete-QOY7UMT9.js";const M=I(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}));function V(){const[j,i]=c.useState([]),[u,m]=c.useState(""),l=localStorage.getItem("TOKEN"),[A,y]=c.useState(!1),[f,p]=c.useState(""),[S,w]=c.useState(!1);c.useEffect(()=>{(async()=>{try{y(!0);const t=await d.get(`${h}/api/shedular/get/shedular`,{headers:{Authorization:`Bearer ${l}`}});i(t.data.schedulers)}catch(t){console.log(t),p("API fetch error")}finally{y(!1)}})()},[l]);const D=(a,t)=>{const r=Array.from({length:7}).map((g,n)=>{const s=new Date(a);return s.setDate(s.getDate()+n),{checked:!1,date:s.toISOString()}});return{weekNo:t,days:r}},v=async()=>{if(!u.trim())return;const a={title:u.trim(),weeks:[D(new Date,1)]};try{const t=await d.post(`${h}/api/shedular/create/shedular`,a,{headers:{Authorization:`Bearer ${l}`}});o.success("Scheduler submitted"),i(r=>[...r,t.data.task]),m("")}catch(t){console.log(t),o.error("Error creating task"),p("API fetch error")}finally{w(!1)}},N=async a=>{try{await d.delete(`${h}/api/shedular/delete/shedular/${a}`),i(t=>t.filter(r=>r._id!==a)),o.success("Sheduler Deleted")}catch(t){console.log(t),o.error("error")}};return f?e.jsx(F,{error:f}):A?e.jsx(C,{}):e.jsxs("div",{className:"habit-wrapper",children:[e.jsxs("div",{className:"habit-input",children:[e.jsx("input",{placeholder:"Enter Daily Task",value:u,onChange:a=>m(a.target.value)}),e.jsx("button",{onClick:v,children:S?e.jsx(L,{}):e.jsx(M,{})})]}),e.jsx(P,{children:j.length===0?e.jsx(x.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},children:"Scheduler Not Yet"},"no-task"):j.map(a=>e.jsxs(x.div,{className:"task-box",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{children:a.title}),e.jsx(W,{onClick:()=>N(a._id),children:e.jsx(H,{sx:{color:"red"}})})]}),e.jsxs("table",{className:"habit-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Week / Month"}),Array.from({length:7}).map((t,r)=>e.jsxs("th",{children:["Day ",r+1]},r))]})}),e.jsx("tbody",{children:a.weeks.map((t,r)=>{const g=new Date(t.days[0].date).toLocaleString("default",{month:"long"});return e.jsxs("tr",{children:[e.jsxs("td",{children:["Week ",t.weekNo," ",e.jsx("br",{}),e.jsx("span",{children:g})]}),t.days.map((n,s)=>e.jsxs("td",{children:[e.jsxs("label",{className:`check-label ${n.checked?"checked":""}`,children:[e.jsx(x.input,{type:"checkbox",checked:n.checked,onChange:_=>(async(k,$,E,T)=>{try{const z=await d.put(`${h}/api/shedular/check`,{taskId:k,weekNo:$,dayIndex:E,checked:T},{headers:{Authorization:`Bearer ${l}`}});i(B=>B.map(b=>b._id===k?z.data.task:b))}catch{o.error("Failed to update"),p("API fetch error")}})(a._id,t.weekNo,s,_.target.checked),whileTap:{scale:1.2}}),e.jsx("span",{})]}),e.jsx("div",{className:"date-label",children:new Date(n.date).getDate()})]},s))]},r)})})]})]},a._id))})]})}export{V as default};
