import{ac as R,y as he,r as p,j as u,p as ve,B as je,I as pe,z as q}from"./index-D2XMCoXW.js";import{a as N,b as C}from"./api-DUhR3JNR.js";import{A as Te}from"./ApiError-B-Ds-A89.js";import{D as xe}from"./Delete-DWaFHfQN.js";var k,Y;function ce(){if(Y)return k;Y=1;function t(r){var i=typeof r;return r!=null&&(i=="object"||i=="function")}return k=t,k}var w,J;function ye(){if(J)return w;J=1;var t=typeof R=="object"&&R&&R.Object===Object&&R;return w=t,w}var B,Q;function de(){if(Q)return B;Q=1;var t=ye(),r=typeof self=="object"&&self&&self.Object===Object&&self,i=t||r||Function("return this")();return B=i,B}var G,V;function _e(){if(V)return G;V=1;var t=de(),r=function(){return t.Date.now()};return G=r,G}var L,Z;function Se(){if(Z)return L;Z=1;var t=/\s/;function r(i){for(var o=i.length;o--&&t.test(i.charAt(o)););return o}return L=r,L}var A,ee;function Re(){if(ee)return A;ee=1;var t=Se(),r=/^\s+/;function i(o){return o&&o.slice(0,t(o)+1).replace(r,"")}return A=i,A}var F,re;function le(){if(re)return F;re=1;var t=de(),r=t.Symbol;return F=r,F}var D,te;function qe(){if(te)return D;te=1;var t=le(),r=Object.prototype,i=r.hasOwnProperty,o=r.toString,s=t?t.toStringTag:void 0;function h(l){var m=i.call(l,s),d=l[s];try{l[s]=void 0;var n=!0}catch{}var f=o.call(l);return n&&(m?l[s]=d:delete l[s]),f}return D=h,D}var W,ne;function Ee(){if(ne)return W;ne=1;var t=Object.prototype,r=t.toString;function i(o){return r.call(o)}return W=i,W}var $,ie;function Oe(){if(ie)return $;ie=1;var t=le(),r=qe(),i=Ee(),o="[object Null]",s="[object Undefined]",h=t?t.toStringTag:void 0;function l(m){return m==null?m===void 0?s:o:h&&h in Object(m)?r(m):i(m)}return $=l,$}var z,ae;function Ie(){if(ae)return z;ae=1;function t(r){return r!=null&&typeof r=="object"}return z=t,z}var M,oe;function Ne(){if(oe)return M;oe=1;var t=Oe(),r=Ie(),i="[object Symbol]";function o(s){return typeof s=="symbol"||r(s)&&t(s)==i}return M=o,M}var P,ue;function Ce(){if(ue)return P;ue=1;var t=Re(),r=ce(),i=Ne(),o=NaN,s=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,l=/^0o[0-7]+$/i,m=parseInt;function d(n){if(typeof n=="number")return n;if(i(n))return o;if(r(n)){var f=typeof n.valueOf=="function"?n.valueOf():n;n=r(f)?f+"":f}if(typeof n!="string")return n===0?n:+n;n=t(n);var b=h.test(n);return b||l.test(n)?m(n.slice(2),b?2:8):s.test(n)?o:+n}return P=d,P}var H,se;function ke(){if(se)return H;se=1;var t=ce(),r=_e(),i=Ce(),o="Expected a function",s=Math.max,h=Math.min;function l(m,d,n){var f,b,T,v,e,a,g=0,x=!1,y=!1,E=!0;if(typeof m!="function")throw new TypeError(o);d=i(d)||0,t(n)&&(x=!!n.leading,y="maxWait"in n,T=y?s(i(n.maxWait)||0,d):T,E="trailing"in n?!!n.trailing:E);function O(c){var j=f,_=b;return f=b=void 0,g=c,v=m.apply(_,j),v}function fe(c){return g=c,e=setTimeout(S,d),x?O(c):v}function me(c){var j=c-a,_=c-g,X=d-j;return y?h(X,T-_):X}function U(c){var j=c-a,_=c-g;return a===void 0||j>=d||j<0||y&&_>=T}function S(){var c=r();if(U(c))return K(c);e=setTimeout(S,me(c))}function K(c){return e=void 0,E&&f?O(c):(f=b=void 0,v)}function be(){e!==void 0&&clearTimeout(e),g=0,f=a=b=e=void 0}function ge(){return e===void 0?v:K(r())}function I(){var c=r(),j=U(c);if(f=arguments,b=this,a=c,j){if(e===void 0)return fe(a);if(y)return clearTimeout(e),e=setTimeout(S,d),O(a)}return e===void 0&&(e=setTimeout(S,d)),v}return I.cancel=be,I.flush=ge,I}return H=l,H}var we=ke();const Be=he(we),De=()=>{const[t,r]=p.useState([]),[i,o]=p.useState(!0),s=localStorage.getItem("TOKEN"),[h,l]=p.useState("");p.useEffect(()=>{(async()=>{try{const{data:a}=await N.get(`${C}/api/routen/createRoutine`,{headers:{Authorization:`Bearer ${s}`}});r(a.blocks||[])}catch{q.error("Failed to load routine"),l("Failed to load routine")}finally{o(!1)}})()},[s]);const m=async e=>{try{await N.put(`${C}/api/routen/routine`,{blocks:e},{headers:{Authorization:`Bearer ${s}`}})}catch(a){console.log(a),q.error("Failed to save routine"),l("Failed to load routine")}},d=p.useCallback(Be(e=>{m(e)},700),[]);p.useEffect(()=>()=>{d.cancel()},[d]),p.useEffect(()=>{i||d(t)},[t,i,d]);const n=e=>r(a=>a.map(g=>g.id===e?{...g,done:!g.done}:g)),f=(e,a)=>r(g=>g.map(x=>x.id===e?{...x,text:a}:x)),b=e=>r(a=>[...a,{id:Date.now(),type:e,text:e==="heading"?"New Section":"New Item",done:!1}]),T=e=>r(a=>a.filter(g=>g.id!==e)),v=async()=>{try{await N.delete(`${C}/api/routen/routine`,{headers:{Authorization:`Bearer ${s}`}}),r([]),q.success("Routine deleted")}catch(e){console.log(e),q.error("Failed to delete routine"),l("Failed to load routine")}};return i?u.jsx(ve,{}):h?u.jsx(Te,{error:h}):u.jsxs("div",{className:"routine",children:[u.jsxs("div",{className:"routine__header",children:[u.jsx("h1",{children:"My Routine"}),u.jsx(je,{color:"error",variant:"outlined",onClick:v,children:"Delete Routine"})]}),u.jsxs("div",{className:"routine__toolbar",children:[u.jsx("button",{onClick:()=>b("heading"),children:"+ Heading"}),u.jsx("button",{onClick:()=>b("check"),children:"+ Checklist"}),u.jsx("button",{onClick:()=>b("note"),children:"+ Note"}),u.jsx("button",{onClick:()=>b("divider"),children:"+ Divider"})]}),u.jsx("div",{className:"routine__editor",children:t.length===0?u.jsx("p",{className:"routine__empty",children:"Your routine is empty. Add blocks above."}):t.map(e=>e.type==="heading"?u.jsx("pre",{contentEditable:!0,suppressContentEditableWarning:!0,className:"routine__heading",onBlur:a=>f(e.id,a.currentTarget.innerText),children:e.text},e.id):e.type==="check"?u.jsxs("div",{className:"routine__check",children:[u.jsx("input",{type:"checkbox",checked:e.done,onChange:()=>n(e.id)}),u.jsx("span",{contentEditable:!0,suppressContentEditableWarning:!0,className:e.done?"done":"",onBlur:a=>f(e.id,a.currentTarget.innerText),children:e.text}),u.jsx(pe,{size:"small",onClick:()=>T(e.id),children:u.jsx(xe,{fontSize:"small"})})]},e.id):e.type==="note"?u.jsx("p",{contentEditable:!0,suppressContentEditableWarning:!0,className:"routine__note",onBlur:a=>f(e.id,a.currentTarget.innerText),children:e.text},e.id):e.type==="divider"?u.jsx("hr",{},e.id):null)})]})};export{De as default};
