import{r,l as w,u as T,j as e,n as y,B as d,z as o}from"./index-GuULtFLE.js";import{S as W}from"./SideBar-CKQIWIvr.js";import{a as b,b as E}from"./api-DUhR3JNR.js";import{A as B}from"./ApiError-Bt-NL0D1.js";import{u as z}from"./index-eiSoaPR5.js";import{m as n}from"./proxy-B8pL_HiH.js";import{E as L}from"./Edit-Dz4_zCYf.js";import{D as $,a as O,b as U,S as H,c as I}from"./Stack-DP8T9cBr.js";import{T as C}from"./TextField-D5W0ETDv.js";import"./iconBase-D3lCwRQ8.js";import"./getThemeProps-CI7Ui3X1.js";import"./Typography-CvsgPR7R.js";import"./useThemeProps-DljloURH.js";const te=()=>{const[S,l]=r.useState(!1),A=w(),D=z(A.breakpoints.down("sm")),[m,u]=r.useState(null),[p,h]=r.useState(""),[F,g]=r.useState(!1),[c,N]=r.useState(null),i=localStorage.getItem("TOKEN"),f=T(),[P,x]=r.useState(!1),[s,j]=r.useState({username:"",email:"",file:""}),v=a=>{j({...s,[a.target.name]:a.target.value})},k=a=>{if(a.target.files&&a.target.files[0]){const t=a.target.files[0];N(t)}};r.useEffect(()=>{(async()=>{if(!i)return o.error("You are not login"),f("/login");try{g(!0);const t=await b.get(`${E}/api/user/profile`,{headers:{Authorization:`Bearer ${i}`}});u(t.data),j({username:t?.data.username,email:t?.data.email,file:""})}catch(t){console.log(t),o.error("Failed to fetch profile"),h("Api Fetching Error")}finally{g(!1)}})()},[i,f]);const _=async()=>{const a=new FormData;if(a.append("username",s.username),a.append("email",s.email),c&&a.append("file",c),!i)return o.error("You are not login"),f("/login");x(!0);try{const t=await b.put(`${E}/api/user/editProfile`,a,{headers:{Authorization:`Bearer ${i}`}});u(t.data),l(!1),o.success("Profile updated")}catch(t){console.log(t),o.error("Error updating profile"),h("Api Fetching Error")}finally{x(!1)}};return p?e.jsx(B,{error:p}):F?e.jsx(y,{}):e.jsxs("div",{className:"dashboard_container",children:[e.jsx(W,{}),e.jsx("main",{children:e.jsxs(n.div,{className:"profile_container",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx(n.div,{className:"profile_left",whileHover:{scale:1.06},transition:{type:"spring",stiffness:120},children:e.jsx(n.img,{src:m?.avatar,alt:"User Avatar",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5}})}),e.jsxs(n.div,{className:"profile_right",initial:{x:40,opacity:0},animate:{x:0,opacity:1},transition:{duration:.6},children:[e.jsx("h1",{children:m?.username}),e.jsx("p",{className:"email",children:m?.email}),e.jsx("span",{className:"role",children:"Creator"}),e.jsx(n.div,{whileHover:{scale:1.08},className:"edit_btn",children:e.jsx(d,{onClick:()=>l(!0),startIcon:e.jsx(L,{}),children:"Edit Profile"})})]})]})}),e.jsxs($,{open:S,onClose:()=>l(!1),fullScreen:D,fullWidth:!0,maxWidth:"sm",disableRestoreFocus:!0,disableEnforceFocus:!0,children:[e.jsx(O,{children:"Edit Profile"}),e.jsx(U,{children:e.jsxs(H,{spacing:2,mt:1,children:[e.jsx(C,{label:"Username",name:"username",fullWidth:!0,value:s.username,onChange:v}),e.jsx(C,{label:"Email",name:"email",fullWidth:!0,value:s.email,onChange:v}),e.jsxs(d,{fullWidth:!0,component:"label",sx:{mt:2,py:1.2,border:"1px dashed #0ff",color:"#222",fontWeight:"bold",textTransform:"none","&:hover":{backgroundColor:"rgba(0,255,255,0.08)"}},children:[c?c.name:"Avatar",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:k})]})]})}),e.jsxs(I,{children:[e.jsx(d,{onClick:()=>l(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:_,children:P?e.jsx(y,{}):"Update"})]})]})]})};export{te as default};
