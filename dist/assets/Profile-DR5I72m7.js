import{r,q as w,j as e,p as y,o,B as d,z as n}from"./index-D2XMCoXW.js";import{S as T}from"./SideBar-CJv_cUB4.js";import{a as b,b as E}from"./api-DUhR3JNR.js";import{A as W}from"./ApiError-B-Ds-A89.js";import{u as B}from"./Paper-C5y_4jPD.js";import{u as z}from"./index-Nz_kLqyC.js";import{E as L}from"./Edit-NtLDSdXa.js";import{D as $,a as O,b as U,S as H,c as I}from"./Stack-C8U_yw2Y.js";import{T as C}from"./TextField-CpaUP64X.js";import"./iconBase-Duhx7-jp.js";import"./getThemeProps-CC1qMCQc.js";import"./Typography-CubVrqiH.js";import"./useThemeProps-CAWOEhmO.js";import"./index-D3tFZesz.js";const re=()=>{const[S,l]=r.useState(!1),A=B(),D=z(A.breakpoints.down("sm")),[m,u]=r.useState(null),[p,h]=r.useState(""),[F,g]=r.useState(!1),[c,N]=r.useState(null),i=localStorage.getItem("TOKEN"),f=w(),[P,x]=r.useState(!1),[s,j]=r.useState({username:"",email:"",file:""}),v=a=>{j({...s,[a.target.name]:a.target.value})},k=a=>{if(a.target.files&&a.target.files[0]){const t=a.target.files[0];N(t)}};r.useEffect(()=>{(async()=>{if(!i)return n.error("You are not login"),f("/login");try{g(!0);const t=await b.get(`${E}/api/user/profile`,{headers:{Authorization:`Bearer ${i}`}});u(t.data),j({username:t?.data.username,email:t?.data.email,file:""})}catch(t){console.log(t),n.error("Failed to fetch profile"),h("Api Fetching Error")}finally{g(!1)}})()},[i,f]);const _=async()=>{const a=new FormData;if(a.append("username",s.username),a.append("email",s.email),c&&a.append("file",c),!i)return n.error("You are not login"),f("/login");x(!0);try{const t=await b.put(`${E}/api/user/editProfile`,a,{headers:{Authorization:`Bearer ${i}`}});u(t.data),l(!1),n.success("Profile updated")}catch(t){console.log(t),n.error("Error updating profile"),h("Api Fetching Error")}finally{x(!1)}};return p?e.jsx(W,{error:p}):F?e.jsx(y,{}):e.jsxs("div",{className:"dashboard_container",children:[e.jsx(T,{}),e.jsx("main",{children:e.jsxs(o.div,{className:"profile_container",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx(o.div,{className:"profile_left",whileHover:{scale:1.06},transition:{type:"spring",stiffness:120},children:e.jsx(o.img,{src:m?.avatar,alt:"User Avatar",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5}})}),e.jsxs(o.div,{className:"profile_right",initial:{x:40,opacity:0},animate:{x:0,opacity:1},transition:{duration:.6},children:[e.jsx("h1",{children:m?.username}),e.jsx("p",{className:"email",children:m?.email}),e.jsx("span",{className:"role",children:"Creator"}),e.jsx(o.div,{whileHover:{scale:1.08},className:"edit_btn",children:e.jsx(d,{onClick:()=>l(!0),startIcon:e.jsx(L,{}),children:"Edit Profile"})})]})]})}),e.jsxs($,{open:S,onClose:()=>l(!1),fullScreen:D,fullWidth:!0,maxWidth:"sm",disableRestoreFocus:!0,disableEnforceFocus:!0,children:[e.jsx(O,{children:"Edit Profile"}),e.jsx(U,{children:e.jsxs(H,{spacing:2,mt:1,children:[e.jsx(C,{label:"Username",name:"username",fullWidth:!0,value:s.username,onChange:v}),e.jsx(C,{label:"Email",name:"email",fullWidth:!0,value:s.email,onChange:v}),e.jsxs(d,{fullWidth:!0,component:"label",sx:{mt:2,py:1.2,border:"1px dashed #0ff",color:"#222",fontWeight:"bold",textTransform:"none","&:hover":{backgroundColor:"rgba(0,255,255,0.08)"}},children:[c?c.name:"Avatar",e.jsx("input",{hidden:!0,type:"file",accept:"image/*",onChange:k})]})]})}),e.jsxs(I,{children:[e.jsx(d,{onClick:()=>l(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:_,children:P?e.jsx(y,{}):"Update"})]})]})]})};export{re as default};
