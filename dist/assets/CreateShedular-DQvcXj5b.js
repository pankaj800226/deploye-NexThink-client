import{c as B,j as e,r as o,E as W,B as H,z as S}from"./index-BwBHtjEM.js";import{a as $,b as D}from"./api-DUhR3JNR.js";import{A as K}from"./ApiError-BIACpizb.js";import{M as F,i as O,u as N,P as U,a as V,b as G,L as X,m as L}from"./proxy-C_etEG8Z.js";import{D as Y}from"./Delete-De7_VIIK.js";const q=B(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}));function z(s,i){if(typeof s=="function")return s(i);s!=null&&(s.current=i)}function J(...s){return i=>{let n=!1;const l=s.map(c=>{const a=z(c,i);return!n&&typeof a=="function"&&(n=!0),a});if(n)return()=>{for(let c=0;c<l.length;c++){const a=l[c];typeof a=="function"?a():z(s[c],null)}}}}function Q(...s){return o.useCallback(J(...s),s)}class Z extends o.Component{getSnapshotBeforeUpdate(i){const n=this.props.childRef.current;if(n&&i.isPresent&&!this.props.isPresent){const l=n.offsetParent,c=O(l)&&l.offsetWidth||0,a=this.props.sizeRef.current;a.height=n.offsetHeight||0,a.width=n.offsetWidth||0,a.top=n.offsetTop,a.left=n.offsetLeft,a.right=c-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ee({children:s,isPresent:i,anchorX:n,root:l}){const c=o.useId(),a=o.useRef(null),x=o.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:k}=o.useContext(F),w=s.props?.ref??s?.ref,f=Q(a,w);return o.useInsertionEffect(()=>{const{width:b,height:u,top:m,left:y,right:j}=x.current;if(i||!a.current||!b||!u)return;const r=n==="left"?`left: ${y}`:`right: ${j}`;a.current.dataset.motionPopId=c;const t=document.createElement("style");k&&(t.nonce=k);const d=l??document.head;return d.appendChild(t),t.sheet&&t.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${b}px !important;
            height: ${u}px !important;
            ${r}px !important;
            top: ${m}px !important;
          }
        `),()=>{d.contains(t)&&d.removeChild(t)}},[i]),e.jsx(Z,{isPresent:i,childRef:a,sizeRef:x,children:o.cloneElement(s,{ref:f})})}const te=({children:s,initial:i,isPresent:n,onExitComplete:l,custom:c,presenceAffectsLayout:a,mode:x,anchorX:k,root:w})=>{const f=N(se),b=o.useId();let u=!0,m=o.useMemo(()=>(u=!1,{id:b,initial:i,isPresent:n,custom:c,onExitComplete:y=>{f.set(y,!0);for(const j of f.values())if(!j)return;l&&l()},register:y=>(f.set(y,!1),()=>f.delete(y))}),[n,f,l]);return a&&u&&(m={...m}),o.useMemo(()=>{f.forEach((y,j)=>f.set(j,!1))},[n]),o.useEffect(()=>{!n&&!f.size&&l&&l()},[n]),x==="popLayout"&&(s=e.jsx(ee,{isPresent:n,anchorX:k,root:w,children:s})),e.jsx(U.Provider,{value:m,children:s})};function se(){return new Map}const A=s=>s.key||"";function I(s){const i=[];return o.Children.forEach(s,n=>{o.isValidElement(n)&&i.push(n)}),i}const ne=({children:s,custom:i,initial:n=!0,onExitComplete:l,presenceAffectsLayout:c=!0,mode:a="sync",propagate:x=!1,anchorX:k="left",root:w})=>{const[f,b]=V(x),u=o.useMemo(()=>I(s),[s]),m=x&&!f?[]:u.map(A),y=o.useRef(!0),j=o.useRef(u),r=N(()=>new Map),t=o.useRef(new Set),[d,E]=o.useState(u),[p,g]=o.useState(u);G(()=>{y.current=!1,j.current=u;for(let C=0;C<p.length;C++){const h=A(p[C]);m.includes(h)?(r.delete(h),t.current.delete(h)):r.get(h)!==!0&&r.set(h,!1)}},[p,m.length,m.join("-")]);const R=[];if(u!==d){let C=[...u];for(let h=0;h<p.length;h++){const v=p[h],P=A(v);m.includes(P)||(C.splice(h,0,v),R.push(v))}return a==="wait"&&R.length&&(C=R),g(I(C)),E(u),null}const{forceRender:T}=o.useContext(X);return e.jsx(e.Fragment,{children:p.map(C=>{const h=A(C),v=x&&!f?!1:u===p||m.includes(h),P=()=>{if(t.current.has(h))return;if(t.current.add(h),r.has(h))r.set(h,!0);else return;let M=!0;r.forEach(_=>{_||(M=!1)}),M&&(T?.(),g(j.current),x&&b?.(),l&&l())};return e.jsx(te,{isPresent:v,initial:!y.current||n?void 0:!1,custom:i,presenceAffectsLayout:c,mode:a,root:w,onExitComplete:v?void 0:P,anchorX:k,children:C},h)})})};function le(){const[s,i]=o.useState([]),[n,l]=o.useState(""),c=localStorage.getItem("TOKEN"),[a,x]=o.useState(!1),[k,w]=o.useState(""),[f,b]=o.useState(!1);o.useEffect(()=>{(async()=>{try{x(!0);const t=await $.get(`${D}/api/shedular/get/shedular`,{headers:{Authorization:`Bearer ${c}`}});i(t.data.schedulers)}catch(t){console.log(t),w("API fetch error")}finally{x(!1)}})()},[c]);const u=(r,t)=>{const d=Array.from({length:7}).map((E,p)=>{const g=new Date(r);return g.setDate(g.getDate()+p),{checked:!1,date:g.toISOString()}});return{weekNo:t,days:d}},m=async()=>{if(!n.trim())return;const r={title:n.trim(),weeks:[u(new Date,1)]};try{const t=await $.post(`${D}/api/shedular/create/shedular`,r,{headers:{Authorization:`Bearer ${c}`}});S.success("Scheduler submitted"),i(d=>[...d,t.data.task]),l("")}catch(t){console.log(t),S.error("Error creating task"),w("API fetch error")}finally{b(!1)}},y=async(r,t,d,E)=>{try{const p=await $.put(`${D}/api/shedular/check`,{taskId:r,weekNo:t,dayIndex:d,checked:E},{headers:{Authorization:`Bearer ${c}`}});i(g=>g.map(R=>R._id===r?p.data.task:R))}catch{S.error("Failed to update"),w("API fetch error")}},j=async r=>{try{await $.delete(`${D}/api/shedular/delete/shedular/${r}`),i(t=>t.filter(d=>d._id!==r)),S.success("Sheduler Deleted")}catch(t){console.log(t),S.error("error")}};return k?e.jsx(K,{error:k}):a?e.jsx(W,{}):e.jsxs("div",{className:"habit-wrapper",children:[e.jsxs("div",{className:"habit-input",children:[e.jsx("input",{placeholder:"Enter Daily Task",value:n,onChange:r=>l(r.target.value)}),e.jsx("button",{onClick:m,children:f?"Loading...":e.jsx(q,{})})]}),e.jsx(ne,{children:s.length===0?e.jsx(L.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},children:"Scheduler Not Yet"},"no-task"):s.map(r=>e.jsxs(L.div,{className:"task-box",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("h2",{children:r.title}),e.jsx(H,{onClick:()=>j(r._id),children:e.jsx(Y,{sx:{color:"red"}})})]}),e.jsxs("table",{className:"habit-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Week / Month"}),Array.from({length:7}).map((t,d)=>e.jsxs("th",{children:["Day ",d+1]},d))]})}),e.jsx("tbody",{children:r.weeks.map((t,d)=>{const E=new Date(t.days[0].date).toLocaleString("default",{month:"long"});return e.jsxs("tr",{children:[e.jsxs("td",{children:["Week ",t.weekNo," ",e.jsx("br",{}),e.jsx("span",{children:E})]}),t.days.map((p,g)=>e.jsxs("td",{children:[e.jsxs("label",{className:`check-label ${p.checked?"checked":""}`,children:[e.jsx(L.input,{type:"checkbox",checked:p.checked,onChange:R=>y(r._id,t.weekNo,g,R.target.checked),whileTap:{scale:1.2}}),e.jsx("span",{})]}),e.jsx("div",{className:"date-label",children:new Date(p.date).getDate()})]},g))]},d)})})]})]},r._id))})]})}export{le as default};
